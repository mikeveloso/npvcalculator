(function(n){n.npvcalculator=function(t,i){var u={resetButton:n("#reset-button"),yearsDropdown:n("#drpYears"),cashFlowItemsContainer:n("#cashflow-items"),urls:{generateCashFlows:"/home/generatecashflows",calculateNpv:"/home/calculatenpv"}},r=this;r.settings={};r.$element=n(t);r.element=t;r.ensureOptions=function(){(r.settings.resetButton===undefined||r.settings.resetButton===null)&&(r.settings.resetButton=u.resetButton);(r.settings.resetButton===undefined||r.settings.resetButton===null)&&(r.settings.yearsDropdown=u.yearsDropdown);r.settings.urls===undefined||r.settings.urls===null?r.settings.urls=u.urls:((r.settings.urls.generateCashFlows===undefined||r.settings.urls.generateCashFlows===null||r.settings.urls.generateCashFlows==="")&&(r.settings.urls.generateCashFlows=u.urls.generateCashFlows),(r.settings.urls.calculateNpv===undefined||r.settings.urls.calculateNpv===null||r.settings.urls.calculateNpv==="")&&(r.settings.urls.calculateNpv=u.urls.calculateNpv))};r.getNpvValue=function(t,i,r=false){var u,f,e;return r&&(f="CASHFLOWS["+i.toString().toUpperCase()+"].CASHFLOW.YEAR",e="CASHFLOWS["+i.toString().toUpperCase()+"].CASHFLOW.AMOUNT",u={year:null,amount:null}),n.each(t,function(){if(r){if(this.name.toString().toUpperCase().indexOf(f)>=0)u.year=this.value;else if(this.name.toString().toUpperCase().indexOf(e)>=0){u.amount=this.value;return}}else if(this.name.toString().toUpperCase().indexOf(i.toString().toUpperCase())>=0){u=this.value;return}}),u};r.prepareNpvData=function(){var t=r.$element.serializeArray(),i={lowerBoundRate:null,upperBoundRate:null,rateIncrement:null,initialValue:null,years:null,cashFlows:[]};return i.lowerBoundRate=r.getNpvValue(t,"lowerBoundRate",!1),i.upperBoundRate=r.getNpvValue(t,"upperBoundRate",!1),i.rateIncrement=r.getNpvValue(t,"rateIncrement",!1),i.initialValue=r.getNpvValue(t,"initialValue",!1),i.years=r.getNpvValue(t,"years",!1),n.each(t,function(){if(this.name.toString().toUpperCase().indexOf("CASHFLOWS.INDEX")>=0){var n=r.getNpvValue(t,this.value.toString().toUpperCase(),!0);i.cashFlows.push(n)}}),i};r.validateNpv=function(){};r.resetForm=function(n){n.preventDefault();r.showloader(!0);window.location.reload()};r.submitForm=function(t){t.preventDefault();var i=r.prepareNpvData();r.$element.validateNpvCalculator()&&(r.showloader(!0),n.ajax({url:r.settings.urls.calculateNpv,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(i),success:function(n){console.log(n);r.settings.cashFlowItemsContainer.html(n)},complete:function(){r.showloader(!1)}}))};r.generateNpvCashFlows=function(){var t=r.prepareNpvData();r.showloader(!0);n.ajax({type:"POST",url:r.settings.urls.generateCashFlows,contentType:"application/json; charset=utf-8",data:JSON.stringify(t),success:function(n){console.log(n);r.settings.cashFlowItemsContainer.html(n)},complete:function(){r.showloader(!1)}})};r.createPopUpContainer=function(){n("body").append('<div id="popup-window" class="popup-wrapper"><div class= "popup-overlay"><div class="popup-content"><\/span><\/div><\/div><\/div>')};r.showPopupWindow=function(t){t?n("#popup-window").show():n("#popup-window").hide()};r.showloader=function(t){t?n("#popup-window popup-content").html('<span class="spinner"><\/span>'):n("#popup-window popup-content").html("");r.showPopupWindow(t)};r.init=function(){r.settings=n.extend({},u,i);r.ensureOptions(u);r.settings.resetButton.click(function(n){r.resetForm(n)});r.settings.yearsDropdown.change(function(){r.generateNpvCashFlows()});r.$element.submit(function(n){r.submitForm(n)});r.createPopUpContainer();r.showPopupWindow(!1)};r.init()};n.fn.npvcalculator=function(t){return this.each(function(){if(undefined==n(this).data("npvcalculator")){var i=new n.npvcalculator(this,t);n(this).data("npvcalculator",i)}})};n.fn.validateNpvCalculator=function(){return n(this).validate()}})(jQuery);